<div class="d-flex w-100 flex-grow-1 flex-column" *transloco="let t; prefix: 'settings.server'">

  <ul class="nav nav-tabs">
    <li class="nav-item" (click)="tab = 'general'">
      <a class="nav-link" [class.active]="tab === 'general'">{{t('general')}}</a>
    </li>
    <li class="nav-item" (click)="tab = 'metadata-provider'">
      <a class="nav-link" [class.active]="tab === 'metadata-provider'">{{t('metadata-provider')}}</a>
    </li>
  </ul>

  <div class="tab-content mt-2">
    <div class="tab-pane" [class.active]="tab === 'general'">
      @if (settingsForm !== undefined && config() !== undefined) {
        <form [formGroup]="settingsForm" class="w-100 px-2">
          <div class="d-flex flex-column align-items-center gap-4">

            <div class="w-100">
              <h2 class="h2 fw-bold mt-4 mb-4">{{ t('title') }}</h2>

              <div class="d-flex flex-column gap-3">
                @if (settingsForm.get('subscriptionRefreshHour'); as control) {
                  <app-settings-item [control]="control" [title]="t('sub-refresh.label')" [tooltip]="t('sub-refresh.tooltip')">
                    <ng-template #view>{{control.value}}</ng-template>
                    <ng-template #edit>
                      <input
                        type="number"
                        class="form-control"
                        id="subscriptionRefreshHour"
                        formControlName="subscriptionRefreshHour"
                        [min]="0"
                        [max]="23"
                      />
                    </ng-template>
                  </app-settings-item>
                }
              </div>
            </div>

            <div class="w-100">
              <hr class="border mt-5" />
              <h2 class="h2 fw-bold mt-4 mb-4">{{ t('downloader') }}</h2>

              <div class="d-flex flex-column gap-3">
                @if (getFormControl('maxConcurrentTorrents'); as control) {
                  <app-settings-item
                    [control]="control"
                    [title]="t('max-torrents.label')"
                    [tooltip]="t('max-torrents.subTitle')"
                  >
                    <ng-template #view>{{ control.value }}</ng-template>

                    <ng-template #edit>
                      <input
                        type="number"
                        class="form-control"
                        formControlName="maxConcurrentTorrents"
                      />
                    </ng-template>
                  </app-settings-item>
                }

                @if (getFormControl('maxConcurrentImages'); as control) {
                  <app-settings-item
                    [control]="control"
                    [title]="t('max-images.label')"
                    [tooltip]="t('max-images.subTitle')"
                  >
                    <ng-template #view>{{ control.value }}</ng-template>

                    <ng-template #edit>
                      <input
                        type="number"
                        class="form-control"
                        formControlName="maxConcurrentImages"
                      />
                    </ng-template>
                  </app-settings-item>
                }


              </div>
            </div>
          </div>
        </form>
      }
    </div>

    <div class="tab-pane" [class.active]="tab === 'metadata-provider'">
      @if (metadataProvidersFormDefinition(); as formDefinition) {
        <div class="w-100 px-2">
          <ul class="nav nav-pills mb-3">
            @for (kv of metadataProvidersForms; track $index) {
              @let key = kv[0];
              <li class="nav-item" (click)="metadataProviderTab = key">
                <a class="nav-link" [class.active]="metadataProviderTab === key">{{key}}</a>
              </li>
            }
          </ul>

          <div class="tab-content">
            @for (kv of metadataProvidersForms; track $index) {
              @let key = kv[0];
              @let value = kv[1];

              <div class="tab-pane" [class.active]="metadataProviderTab === key">
                <app-generic-form
                  [formDefinition]="formDefinition"
                  [supplyFormGroup]="value"
                  [initialValue]="config()!.metadataProviderSettings[key]"
                />
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>
</div>
