<div class="mx-4 mx-md-5" *transloco="let t; prefix: 'subscriptions'">

  <div class="d-flex flex-grow-1 flex-md-grow-0 justify-content-md-between mb-3">
    <form [formGroup]="filterForm">
      <input class="form-control" type="text" [placeholder]="t('filter')" formControlName="filterText">
    </form>
  </div>

  <app-table
    [pageLoader]="pageLoader()"
    (currentItems)="hasAny.set($event.length > 0)"
    [trackByIdFunc]="trackBy"
    [reloader]="pageReloader"
    [pageSize]="10"
  >
    <ng-template #mobile let-sub>
      <div class="card mobile-card">
        <div class="card-header">
          <a
            class="card-title"
            [href]="sub.contentId | subscriptionExternalUrl:sub.provider"
            target="_blank"
            rel="noopener noreferrer"
            >
            {{ sub.title }}
          </a>
        </div>

        <div class="card-body">
          <div class="mb-2">
            <small class="text-muted">{{ t('provider') }}:</small>
            <span class="ms-2">{{ sub.provider | providerName }}</span>
          </div>
          <div class="mb-2">
            <small class="text-muted">{{ t('content-id') }}:</small>
            <span class="ms-2">{{ sub.contentId }}</span>
          </div>
          <div class="mb-2">
            <small class="text-muted">{{ t('base-dir') }}:</small>
            <span class="ms-2">{{ sub.baseDir }}</span>
          </div>
          <div>
            <small class="text-muted">{{ t('status') }}:</small>
            <span class="ms-2 badge" [class.bg-success]="sub.status === 0" [class.bg-secondary]="sub.status === 1">
              {{ sub.status === 0 ? t('status-enabled') : t('status-disabled') }}
            </span>
          </div>
        </div>

        <div class="card-footer">
          <div class="card-actions">
            <button
              type="button"
              class="btn btn-primary btn-small"
              [ngbTooltip]="t('actions.edit')"
              (click)="edit(sub)"
            >
              <i class="fa fa-pencil"></i>
            </button>

            <button
              type="button"
              class="btn btn-secondary btn-small"
              (click)="runOnce(sub)"
              [ngbTooltip]="t('actions.run-once')"
            >
              <i class="fa fa-download"></i>
            </button>

            <button
              type="button"
              class="btn btn-danger btn-small"
              (click)="delete(sub)"
              [ngbTooltip]="t('actions.delete')"
            >
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template #header>
      <tr>
        <th class="table-header-cell">{{ t('title') }}</th>
        <th class="table-header-cell">{{ t('provider') }}</th>
        <th class="table-header-cell">{{ t('base-dir') }}</th>
        <th class="table-header-cell">{{ t('status') }}</th>
        <th class="table-header-cell">{{ t('actions.label') }}</th>
      </tr>
    </ng-template>

    <ng-template #cell let-sub>
      <td class="table-cell">
        <a
          [href]="sub.contentId | subscriptionExternalUrl:sub.provider"
          target="_blank"
          rel="noopener noreferrer"
        >
          {{ sub.title }}
        </a>
        <div>
          <small class="text-muted">{{ sub.contentId }}</small>
        </div>
      </td>

      <td class="table-cell">
        {{ sub.provider | providerName }}
      </td>

      <td class="table-cell">
        <code class="text-muted">{{ sub.baseDir }}</code>
      </td>

      <td class="table-cell">
        <!-- TODO: Proper pipe, but it's fine for now -->
        <span class="badge" [class.bg-success]="sub.status === 0" [class.bg-secondary]="sub.status === 1">
          {{ sub.status === 0 ? t('status-enabled') : t('status-disabled') }}
        </span>
      </td>

      <td class="table-cell">
        <div class="d-flex flex-column flex-md-row gap-2 my-2 justify-content-center align-items-center">

          <button
            type="button"
            class="btn btn-primary btn-small"
            [ngbTooltip]="t('actions.edit')"
            (click)="edit(sub)"
          >
            <i class="fa fa-pencil"></i>
          </button>

          <button
            type="button"
            class="btn btn-secondary btn-small"
            (click)="runOnce(sub)"
            [ngbTooltip]="t('actions.run-once')"
          >
            <i class="fa fa-download"></i>
          </button>

          <button
            type="button"
            class="btn btn-danger btn-small"
            (click)="delete(sub)"
            [ngbTooltip]="t('actions.delete')"
          >
            <i class="fa fa-trash"></i>
          </button>

        </div>
      </td>
    </ng-template>

    <ng-template #empty>
      <tr>
        <td colspan="5" class="py-5">
          <div class="d-flex flex-column align-items-center text-center gap-3 text-muted">

            <div style="font-size: 3rem;">
              ðŸ””âœ¨
            </div>

            <h5 class="mb-1">
              {{t('empty.title')}}
            </h5>

            <p class="mb-0" [innerHtml]="t('empty.description')">
            </p>

          </div>
        </td>
      </tr>
    </ng-template>

  </app-table>
</div>
