<ng-container *transloco="let t; prefix: 'series-info-modal'">

  <div class="modal-container">

    <div class="modal-header">
      <h5 class="modal-title fw-semibold">{{t('title', {name: seriesTitle()})}}</h5>
      <button type="button" class="btn-close" [attr.aria-label]="t('close')" (click)="close()">
      </button>
    </div>

    <div class="modal-body scrollable-modal">

      @if (loading()) {
        <app-loading-spinner />
      } @else if (series(); as series) {

        <div class="row mb-4">
          @if (coverUrl(); as url) {
            <div class="col-md-4 col-lg-3 mb-3 mb-md-0">
              <img [src]="url"
                   [alt]="series.title"
                   class="img-fluid rounded shadow-sm series-cover">
            </div>
          }
          <div [class]="!!coverUrl() ? 'col-md-8 col-lg-9' : 'col-12'">
            <div class="info-section">
              @if (series.localizedSeries) {
                <div class="mb-2">
                  <span class="text-secondary small">{{t('localized-title')}}</span>
                  <div class="fw-medium">{{series.localizedSeries}}</div>
                </div>
              }

              <div class="d-flex flex-wrap gap-2 mb-3">
                <span class="badge status-badge status-{{series.status}}">
                  {{t('status.' + series.status)}}
                </span>
                @if (series.translationStatus !== null && series.translationStatus !== undefined) {
                  <span class="badge translation-status-badge">
                    {{t('translation-status.' + series.translationStatus)}}
                  </span>
                }
                @if (series.year) {
                  <span class="badge year-badge">{{series.year}}</span>
                }
                @if (series.ageRating !== null && series.ageRating !== undefined) {
                  <span class="badge age-rating-badge">{{t('age-rating.' + series.ageRating)}}</span>
                }
              </div>

              <div class="progress-info">
                @if (series.highestVolumeNumber) {
                  <div class="progress-item">
                    <i class="fa fa-book me-2"></i>
                    <span>{{t('volumes')}}: <strong>{{series.highestVolumeNumber}}</strong></span>
                  </div>
                }
                @if (series.highestChapterNumber) {
                  <div class="progress-item">
                    <i class="fa fa-list me-2"></i>
                    <span>{{t('chapters')}}: <strong>{{series.highestChapterNumber}}</strong></span>
                  </div>
                }
              </div>
            </div>
            @if (series.summary) {
              <div class="info-section my-4">
                <h6 class="section-title">{{t('summary')}}</h6>
                <p class="summary-text">{{series.summary}}</p>
              </div>
            }
          </div>
        </div>

        @if (series.tags.length > 0) {
          <div class="info-section mb-4">
            <h6 class="section-title">{{t('tags-genres')}}</h6>
            <div class="d-flex flex-wrap gap-2">
              @for (tag of series.tags; track tag.id) {
                <span [class]="tag.isMarkedAsGenre ? 'badge genre-badge' : 'badge tag-badge'">
              {{tag.value}}
            </span>
              }
            </div>
          </div>
        }

        @if (series.people.length > 0) {
          <div class="info-section mb-4">
            <h6 class="section-title">{{t('credits')}}</h6>
            <div class="credits-grid">
              @for (person of series.people; track person.name) {
                <div class="credit-item">
                  <div class="credit-name">{{person.name}}</div>
                  <div class="credit-roles">
                    @for (role of person.roles; track role; let last = $last) {
                      <span class="text-secondary small">
                    {{t('role.' + role)}}@if (!last) {<span>, </span>}
                  </span>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        }

        @if (series.links.length > 0 || series.refUrl) {
          <div class="info-section mb-4">
            <h6 class="section-title">{{t('external-links')}}</h6>
            <div class="links-container">
              @if (series.refUrl) {
                <a [href]="series.refUrl" target="_blank" rel="noopener noreferrer" class="external-link">
                  <i class="fa fa-external-link-alt me-2"></i>{{t('source-page')}}
                </a>
              }
              @for (link of series.links; track link) {
                <a [href]="link" target="_blank" rel="noopener noreferrer" class="external-link">
                  <i class="fa fa-link me-2"></i>{{link}}
                </a>
              }
            </div>
          </div>
        }

        @if (series.chapters.length > 0) {
          <div class="info-section">
            <h6 class="section-title">{{t('recent-chapters')}} ({{series.chapters.length}})</h6>
            <div class="chapters-list">
              @for (chapter of series.chapters; track chapter.id) {
                <div class="chapter-item">
                  <div class="d-flex align-items-start gap-3">
                    <div class="flex-grow-1">
                      <div class="chapter-markers mb-1 d-flex flex-row">
                        @if (chapter.volumeMarker) {
                          <div><span class="badge volume-badge me-1">Volume {{chapter.volumeMarker}}</span></div>
                        }
                        @if (chapter.chapterMarker) {
                          <div><span class="badge chapter-badge">Chapter {{chapter.chapterMarker}}</span></div>
                        }
                        <div class="chapter-title ms-2">{{chapter.title}}</div>
                      </div>
                      @if (chapter.summary) {
                        <p class="chapter-summary text-secondary small mb-2">{{chapter.summary}}</p>
                      }
                      <div class="chapter-meta">
                        @if (chapter.releaseDate && chapter.releaseDate !== '0001-01-01T00:00:00') {
                          <span class="small text-secondary me-3">
                            <i class="fa fa-calendar me-1"></i>{{chapter.releaseDate | utcToLocalTime}}
                          </span>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }

      } @else {
        <div class="alert alert-warning" role="alert">
          <i class="fa fa-exclamation-triangle me-2"></i>{{t('no-data')}}
        </div>
      }

    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="close()">
        {{t('close')}}
      </button>
    </div>

  </div>

</ng-container>
